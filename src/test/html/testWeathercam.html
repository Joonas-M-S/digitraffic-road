<html>
<head>
    <style></style>
    <script>
        var url = "http://tie-test.digitraffic.fi/api/beta/camera-preset-history/";
        var current_index = -1;
        var myObj;

        function get_history(preset) {
            xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    try {
                        myObj = JSON.parse(this.responseText);

                        console.log(myObj);

                        current_index = -1;

                        change_index(1);
                    } catch (e) {
                        console.log(e);

                        txt = "Error occurred!";
                    }
                }
            };
            xmlhttp.onerror = function () {
                console.log(this);

                //document.getElementById(divBlock).innerHTML = "Load failure!";
            }
            xmlhttp.open("GET", url + preset, true);

            xmlhttp.send();
        }

        function get_image(image, timestamp) {
            console.log(image + " " + timestamp);

            document.getElementById("kuva").src = image;
            document.getElementById("aika").innerHTML = timestamp;
        }

        function change_index(change) {
            if (myObj) {
                current_index += change;

                if (current_index < 0) {
                    current_index = myObj.history.length - 1;
                } else if (current_index >= myObj.history.length) {
                    current_index = 0;
                }

                get_image(myObj.history[current_index].url, myObj.history[current_index].lastModified);
            }
        }

        get_history("C0460900");
    </script>
</head>
<body>
<h1>Kuva historia</h1>
<div>
    <button onclick="change_index(1)">Vanhempi</button>
    <button onclick="change_index(-1)">Uudempi</button>
</div>
<div id="aika"></div>
<img src="" id="kuva"/>
</body>
</html>